æ•´ç†ByXuFang(871271203)
å…¨éƒ¨å¤åˆ¶äºŽå®˜æ–¹æ¸¸æˆæ•™ç¨‹


##############################################ç¬¬ä¸€å…³#####################################################

##############################################ç¬¬ä¸€å…³#####################################################

##############################################ç¬¬ä¸€å…³#####################################################

**********************æ¸¸æˆUIä¸ŽåŸºç¡€ç¼–ç¨‹*****************************



	æ‚¨çš„ Spawn å¯ä»¥é€šè¿‡ spawnCreep æ–¹æ³•åˆ›å»ºåä¸º â€œcreepâ€ çš„æ–°å•ä½ã€‚å¯ä»¥åœ¨ æœ¬æ–‡æ¡£ ä¸­æ‰¾åˆ°è¯¥æ–¹æ³•çš„ä»‹ç»ã€‚æ¯ä¸ª creep éƒ½æœ‰ä¸€ä¸ªåå­—ï¼ˆnameï¼‰å’Œä¸€å®šé‡çš„èº«ä½“éƒ¨ä»¶ï¼ˆbody partï¼‰ï¼Œä¸åŒçš„èº«ä½“éƒ¨ä»¶ä¼šå¸¦æ¥ä¸åŒçš„èƒ½åŠ›ã€‚
æ‚¨å¯ä»¥ä½¿ç”¨æ‚¨ spawn çš„åå­—æ¥èŽ·å–åˆ°å®ƒï¼Œå°±åƒè¿™æ ·ï¼šGame.spawns['Spawn1']ã€‚
åˆ›å»ºä¸€ä¸ªèº«ä½“éƒ¨ä»¶ä¸º [WORK,CARRY,MOVE] å¹¶ä¸”åå­—å«åš Harvester1ï¼ˆè¿™ä¸ªåå­—å¯¹æœ¬æ•™ç¨‹æ¥è¯´éžå¸¸é‡è¦ï¼ï¼‰çš„å·¥äºº creepã€‚æ‚¨å¯ä»¥è‡ªå·±åœ¨æŽ§åˆ¶å°ä¸­è¾“å…¥è¿™äº›ä»£ç ï¼Œæˆ–è€…å¤åˆ¶ & ç²˜è´´ä¸‹é¢çš„æç¤ºã€‚


Game.spawns['Spawn1'].spawnCreep( [WORK, CARRY, MOVE], 'Harvester1' );









	æƒ³è®© creep åŽ»é‡‡é›†èƒ½é‡ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä¸‹é¢ â€œæ–‡æ¡£â€ å°èŠ‚ä¸­ä»‹ç»çš„æ–¹æ³•ï¼Œè¿™äº›æŒ‡ä»¤æ¯ä¸ªæ¸¸æˆ tick éƒ½ä¼šè¢«æ‰§è¡Œã€‚è€Œ harvest æ–¹æ³•åˆ™éœ€è¦åœ¨ creep ç›¸é‚»çš„ä½ç½®ä¸Šæœ‰ä¸€ä¸ªèƒ½é‡æºã€‚
æ‚¨å¯ä»¥é€šè¿‡ creep çš„åå­—æ¥èŽ·å–åˆ°å®ƒå¹¶å¯¹å…¶ä¸‹è¾¾å‘½ä»¤ï¼Œå°±åƒè¿™æ ·ï¼šGame.creeps['Harvester1']ã€‚æŠŠ FIND_SOURCES å¸¸é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ Room.find æ–¹æ³•å¯ä»¥æˆ¿é—´ä¸­çš„èƒ½é‡æºã€‚
é€šè¿‡åœ¨ â€œè„šæœ¬â€ é¢æ¿ä¸­é”®å…¥ä»£ç æ¥è®©æ‚¨çš„ creep å‰åŽ»é‡‡é›†èƒ½é‡ã€‚


module.exports.loop = function () {
    var creep = Game.creeps['Harvester1'];
    var sources = creep.room.find(FIND_SOURCES);
    if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
        creep.moveTo(sources[0]);
    }
}







	æƒ³è¦ç»´æŠ¤ extensionï¼Œæ‚¨éœ€è¦æ•™ä¼šæ‚¨çš„é‡‡é›†å•ä½æŠŠèƒ½é‡è¿è¾“åˆ° extension è€Œä¸ä»…ä»…æ˜¯ spawnã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ Game.structures å¯¹è±¡æˆ–è€…åœ¨å¯¹åº”çš„æˆ¿é—´æ‰§è¡Œ Room.find(FIND_STRUCTURES) æ–¹æ³•è¿›è¡Œæœç´¢ã€‚æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼ï¼Œæ‚¨éƒ½éœ€è¦ç”¨åˆ¤æ–­æ¡ä»¶ structure.structureType == STRUCTURE_EXTENSIONï¼ˆæˆ–è€… structure instanceof StructureExtensionï¼‰å¯¹ç»“æžœåˆ—è¡¨è¿›è¡Œç­›é€‰ï¼Œè¿˜æœ‰åˆ«å¿˜äº†æ£€æŸ¥å®ƒä»¬å­˜æœ‰å¤šå°‘èƒ½é‡ï¼ˆå°±åƒä¹‹å‰æ£€æŸ¥ creep ä¸€æ ·ï¼‰ã€‚
	ä¼˜åŒ– role.harvester æ¨¡å—ä¸­çš„é€»è¾‘ã€‚
	
	
var roleHarvester = {

    /** @param {Creep} creep **/
    run: function(creep) {
	    if(creep.store.getFreeCapacity() > 0) {
            var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});
            }
        }
        else {
            var targets = creep.room.find(FIND_STRUCTURES, {
                    filter: (structure) => {
                        return (structure.structureType == STRUCTURE_EXTENSION || structure.structureType == STRUCTURE_SPAWN) &&
                            structure.store.getFreeCapacity(RESOURCE_ENERGY) > 0;
                    }
            });
            if(targets.length > 0) {
                if(creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {
                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});
                }
            }
        }
	}
};

module.exports = roleHarvester;






	æƒ³è¦äº†è§£æˆ¿é—´é‡Œæ€»å…±æœ‰å¤šå°‘èƒ½é‡å¯ä»¥ç”¨äºŽå­µåŒ–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Room.energyAvailable å±žæ€§ã€‚è®©æˆ‘ä»¬æŠŠè¿™ä¸ªå±žæ€§è¾“å‡ºåˆ°æŽ§åˆ¶å°ä¸­ä»¥ä¾¿åœ¨ extension å¡«å……æœŸé—´å¯¹å…¶è¿›è¡Œè¿½è¸ªã€‚
	æ‰¾åˆ°å…¨éƒ¨çš„ 5 ä¸ª extension ä»¥åŠ spawn å¹¶å¡«å……èƒ½é‡ã€‚
	
	
	
var roleHarvester = require('role.harvester');
var roleBuilder = require('role.builder');

module.exports.loop = function () {

    for(var name in Game.rooms) {
        console.log('Room "'+name+'" has '+Game.rooms[name].energyAvailable+' energy');
    }

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'builder') {
            roleBuilder.run(creep);
        }
    }
}










	æƒ³è¦è®© creep æŠŠèƒ½é‡è¿é€å›ž spawnï¼Œæ‚¨éœ€è¦ä½¿ç”¨ Creep.transfer æ–¹æ³•ã€‚ä½†æ˜¯è¯·è®°ä½ï¼Œè¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨ creep å’Œ spawn ç›¸é‚»çš„æ—¶å€™æ‰èƒ½æ­£ç¡®æ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦è®© creep å…ˆèµ°å›žæ¥ã€‚
å½“æ‚¨æŠŠ .store.getFreeCapacity() > 0 ä½œä¸ºæ£€æŸ¥æ¡ä»¶æ·»åŠ åˆ°ä»£ç é‡Œæ—¶ï¼Œcreep åº”è¯¥å°±å¯ä»¥è‡ªå·±ä¸€æ­¥æ­¥çš„æŠŠèƒ½é‡æ¬è¿å›ž spawn ç„¶åŽèµ°å›žèƒ½é‡æºã€‚


module.exports.loop = function () {
    var creep = Game.creeps['Harvester1'];

    if(creep.store.getFreeCapacity() > 0) {
        var sources = creep.room.find(FIND_SOURCES);
        if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
            creep.moveTo(sources[0]);
        }
    }
    else {
        if( creep.transfer(Game.spawns['Spawn1'], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE ) {
            creep.moveTo(Game.spawns['Spawn1']);
        }
    }
}










	Niceï¼çŽ°åœ¨è¿™ä¸ª creep å°†ä¼šä¸€ç›´ä½œä¸ºé‡‡é›†è€…ï¼ˆharvesterï¼‰å·¥ä½œç›´åˆ°åŽ»ä¸–ã€‚è¯·è®°ä½ï¼Œå‡ ä¹Žæ‰€æœ‰çš„ creep éƒ½æœ‰ 1500 æ¸¸æˆ tick çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨æ­¤ä¹‹åŽå®ƒå°±ä¼š â€œè€åŽ»â€ ç„¶åŽæ­»æŽ‰ï¼ˆè¿™ä¸ªè®¾å®šåœ¨æœ¬æ•™ç¨‹ä¸­å¹¶ä¸ç”Ÿæ•ˆï¼‰ã€‚
è®©æˆ‘ä»¬å­µåŒ–æ–°çš„ creep æ¥å¸®åŠ©ç¬¬ä¸€ä¸ªã€‚è¿™ä¼šæ¶ˆè€—æŽ‰ 200 ç‚¹èƒ½é‡ï¼Œæ‰€ä»¥æ‚¨å¯èƒ½éœ€è¦ç­‰åˆ°é‡‡é›†å•ä½æ”¶é›†åˆ°è¶³å¤Ÿçš„èƒ½é‡ã€‚spawnCreep æ–¹æ³•ä¼šè¿”å›žé”™è¯¯ç  ERR_NOT_ENOUGH_ENERGYï¼ˆ-6ï¼‰ç›´åˆ°æ‚¨èƒ½é‡è¶³å¤Ÿä¸ºæ­¢ã€‚
è¯·è®°ä½ï¼šæƒ³è¦æ‰§è¡Œä¸€æ¬¡æ€§çš„ä»£ç çš„è¯ï¼Œç›´æŽ¥åœ¨ â€œæŽ§åˆ¶å°â€ é¢æ¿ä¸­è¾“å…¥å°±å¯ä»¥äº†ã€‚


Game.spawns['Spawn1'].spawnCreep( [WORK, CARRY, MOVE], 'Harvester2' );









	ç¬¬äºŒä¸ª creep å·²ç»å°±ç»ªäº†ï¼Œä½†æ˜¯å®ƒçŽ°åœ¨è¿˜ä¸ä¼šåŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å…¶æ·»åŠ è¿›æˆ‘ä»¬çš„ç¨‹åºã€‚
æƒ³è¦ç»™æ‰€æœ‰çš„ creep éƒ½è®¾ç½®è¡Œä¸ºï¼Œåªéœ€è¦æŠŠæ•´ä¸ªè„šæœ¬ä¸ºæ–°çš„ creep å¤åˆ¶ä¸€éå°±å¥½äº†ï¼Œä½†æ˜¯æ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨ for å¾ªçŽ¯æ¥éåŽ† Game.creeps ä¸­çš„æ‰€æœ‰ creepã€‚
æ‹“å±•æ‚¨çš„ç¨‹åºï¼Œä½¿å…¶å¯ä»¥é€‚ç”¨åˆ°æ‰€æœ‰ creep ä¸Šã€‚


module.exports.loop = function () {
    for(var name in Game.creeps) {
        var creep = Game.creeps[name];

        if(creep.store.getFreeCapacity() > 0) {
            var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0]);
            }
        }
        else {
            if(creep.transfer(Game.spawns['Spawn1'], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {
                creep.moveTo(Game.spawns['Spawn1']);
            }
        }
    }
}









	çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬æŠŠå·¥ä½œå•ä½çš„è¡Œä¸ºé€»è¾‘å°è£…åˆ°ä¸€ä¸ªå•ç‹¬çš„ module é‡Œæ¥æ”¹å–„æˆ‘ä»¬çš„ä»£ç ã€‚ä½¿ç”¨æ¨¡å—åŠŸèƒ½åˆ›å»ºä¸€ä¸ªåä¸º role.harvester çš„æ¨¡å—ï¼Œæ‚¨å¯ä»¥åœ¨è„šæœ¬ç¼–è¾‘å™¨çš„å·¦ä¾§æ‰¾åˆ°å®ƒã€‚ç„¶åŽåœ¨ module.exports å¯¹è±¡ä¸­å®šä¹‰ä¸€ä¸ª run å‡½æ•°æ¥å­˜æ”¾ creep çš„è¡Œä¸ºé€»è¾‘ã€‚


var roleHarvester = {

    /** @param {Creep} creep **/
    run: function(creep) {
	    if(creep.store.getFreeCapacity() > 0) {
            var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0]);
            }
        }
        else {
            if(creep.transfer(Game.spawns['Spawn1'], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {
                creep.moveTo(Game.spawns['Spawn1']);
            }
        }
	}
};

module.exports = roleHarvester;





	çŽ°åœ¨ï¼Œæ‚¨å¯ä»¥é‡å†™ main æ¨¡å—çš„ä»£ç ï¼Œåªç•™ä¸‹ loop å‡½æ•°ï¼Œå¹¶é€šè¿‡ require('role.harvester') æ–¹æ³•è°ƒç”¨æ‚¨çš„æ–°æ¨¡å—ã€‚
	å°† role.harvester æ¨¡å—å¼•å…¥åˆ° main æ¨¡å—ä¸­ã€‚


var roleHarvester = require('role.harvester');

module.exports.loop = function () {

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        roleHarvester.run(creep);
    }
}




##############################################ç¬¬äºŒå…³#####################################################

##############################################ç¬¬äºŒå…³#####################################################

##############################################ç¬¬äºŒå…³#####################################################

**********************å‡çº§æŽ§åˆ¶å™¨*****************************



	æ‚¨å°†éœ€è¦ä¸€ä¸ªæ–° creep å·¥ä½œå•ä½åŽ»å‡çº§æ‚¨çš„æŽ§åˆ¶å™¨ç­‰çº§ï¼Œè®©æˆ‘ä»¬ç§°å…¶ä¸º â€œUpgrader1â€ã€‚åœ¨æŽ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­æˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•è‡ªåŠ¨åˆ›å»º creepï¼Œä½†æ˜¯çŽ°åœ¨è®©æˆ‘ä»¬è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·åœ¨æŽ§åˆ¶å™¨é‡Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤ã€‚

Game.spawns['Spawn1'].spawnCreep( [WORK, CARRY, MOVE], 'Upgrader1' );








    
    ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨æ¯ä¸ª creep éƒ½æœ‰çš„ memory å±žæ€§ï¼Œè¯¥å±žæ€§å…è®¸åœ¨ creep çš„â€œå†…å­˜â€ä¸­å†™å…¥è‡ªå®šä¹‰ä¿¡æ¯ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™ creep åˆ†é…ä¸åŒçš„è§’è‰²ã€‚
æ‚¨å°†éœ€è¦ä¸€ä¸ªæ–° creep å·¥ä½œå•ä½åŽ»å‡çº§æ‚¨çš„æŽ§åˆ¶å™¨ç­‰çº§ï¼Œè®©æˆ‘ä»¬ç§°å…¶ä¸º â€œUpgrader1â€ã€‚åœ¨æŽ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­æˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•è‡ªåŠ¨åˆ›å»º creepï¼Œä½†æ˜¯çŽ°åœ¨è®©æˆ‘ä»¬è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·åœ¨æŽ§åˆ¶å™¨é‡Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤ã€‚
æ‚¨å‚¨å­˜çš„æ‰€æœ‰å†…å­˜ä¿¡æ¯å¯ä»¥é€šè¿‡å…¨å±€å¯¹è±¡ å†…å­˜ è®¿é—®ã€‚è¿™ä¸¤ç§æ–¹å¼æ‚¨æƒ³ç”¨å“ªç§éƒ½å¯ä»¥ã€‚
	ä½¿ç”¨æŽ§åˆ¶å°å°†å±žæ€§ role='harvester' å†™å…¥é‡‡é›†å•ä½çš„å†…å­˜ï¼Œå°† role='upgrader' å†™å…¥å‡çº§å•ä½çš„å†…å­˜ã€‚


Game.creeps['Harvester1'].memory.role = 'harvester';
Game.creeps['Upgrader1'].memory.role = 'upgrader';








	æ‚¨å¯ä»¥åœ¨å·¦ä¾§çš„ creep ä¿¡æ¯é¢æ¿æˆ–è€… â€œå†…å­˜â€ é¢æ¿ä¸­æŸ¥çœ‹æ‚¨ creep çš„å†…å­˜ã€‚
çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å®šä¹‰æ–° creep çš„è¡Œä¸ºé€»è¾‘ã€‚ä¸¤ç§ creep éƒ½éœ€è¦é‡‡é›†èƒ½é‡ï¼Œä½†æ˜¯è§’è‰²ä¸º harvester çš„ creep éœ€è¦æŠŠèƒ½é‡å¸¦å›žåˆ° spawnï¼Œè€Œè§’è‰²ä¸º upgrader çš„ creep éœ€è¦èµ°åˆ° controller æ—ç„¶åŽå¯¹å…¶æ‰§è¡Œ upgradeController æ–¹æ³•ï¼ˆæ‚¨å¯ä»¥é€šè¿‡ Creep.room.controller å±žæ€§èŽ·å–åˆ° creep æ‰€åœ¨æˆ¿é—´çš„ controller å¯¹è±¡ï¼‰ã€‚
ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º role.upgrader çš„æ–°æ¨¡å—ã€‚
	åˆ›å»ºåä¸º role.upgrader çš„æ–°æ¨¡å—ï¼Œå¹¶å†™å…¥æ‚¨æ–° creep çš„è¡Œä¸ºé€»è¾‘ã€‚


var roleUpgrader = {

    /** @param {Creep} creep **/
    run: function(creep) {
	    if(creep.store[RESOURCE_ENERGY] == 0) {
            var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0]);
            }
        }
        else {
            if(creep.upgradeController(creep.room.controller) == ERR_NOT_IN_RANGE) {
                creep.moveTo(creep.room.controller);
            }
        }
	}
};

module.exports = roleUpgrader;










	åœ¨æˆ‘ä»¬çš„ main æ¨¡å—ä¸­ï¼Œæ‰€æœ‰çš„ creep éƒ½åœ¨æ‰®æ¼”ç›¸åŒçš„è§’è‰²ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨å…ˆå‰å®šä¹‰çš„ Creep.memory.role å±žæ€§åŒºåˆ†å®ƒä»¬çš„è¡Œä¸ºï¼Œæ³¨æ„ä¸è¦å¿˜è®°å¯¼å…¥æ–°æ¨¡å—å“¦ã€‚
å°† role.upgrader æ¨¡å—ä¸­çš„é€»è¾‘åº”ç”¨åˆ°æ‹¥æœ‰ upgrader è§’è‰²çš„ creep èº«ä¸Šå¹¶æ£€æŸ¥å…¶è¡¨çŽ°ã€‚


var roleHarvester = require('role.harvester');
var roleUpgrader = require('role.upgrader');

module.exports.loop = function () {

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'upgrader') {
            roleUpgrader.run(creep);
        }
    }
}








###############################################ç¬¬ä¸‰å…³##################################################

###############################################ç¬¬ä¸‰å…³##################################################

###############################################ç¬¬ä¸‰å…³##################################################

*************************å»ºé€ å»ºç­‘*****************************






	æŽ§åˆ¶å™¨å‡çº§è§£é”äº†æ–°çš„å»ºç­‘ï¼šwallã€rampart ä»¥åŠ extensionã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸ªæ•™ç¨‹éƒ¨åˆ†è®¨è®º wall å’Œ rampartï¼ŒçŽ°åœ¨è®©æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ extensionã€‚
Extension è¢«ç”¨æ¥å­µåŒ–æ›´å¤§åž‹çš„ creepã€‚æ¯ç§èº«ä½“ç±»åž‹åªæœ‰ä¸€ä¸ªéƒ¨ä»¶çš„ creep å·¥ä½œå¹¶ä¸é«˜æ•ˆã€‚å¤šä¸ºå…¶æ·»åŠ å‡ ä¸ª WORK éƒ¨ä»¶å¯ä»¥è®©å®ƒä»¬æˆæ¯”ä¾‹çš„æé«˜æ•ˆçŽ‡ã€‚
ä½†æ˜¯ï¼Œè¿™æ ·çš„ creep ä¼šæ›´åŠ çš„æ˜‚è´µï¼Œå¹¶ä¸”å•ç‹¬ä¸€ä¸ª spawn åªèƒ½å®¹çº³æœ€å¤š 300 ç‚¹èƒ½é‡ã€‚æƒ³è¦å­µåŒ–æˆæœ¬è¶…è¿‡ 300 ç‚¹èƒ½é‡çš„ creepï¼Œæ‚¨éœ€è¦ spawn æ‹“å±•ï¼ˆå³ extensionï¼‰ã€‚


	äºŒçº§ controller å°†å…è®¸æ‚¨å»ºé€  5 ä¸ª extensionã€‚æ¯æ¬¡ controller å‡çº§éƒ½ä¼šè§£é”æ›´å¤šçš„ extensionã€‚
æ‚¨å¯ä»¥åœ¨æ‚¨æˆ¿é—´ä¸­çš„ä»»ä½•ä½ç½®æ”¾ç½® extensionï¼Œå¹¶ä¸” spawn å¯ä»¥æ— è§†å½¼æ­¤ä¹‹é—´çš„è·ç¦»ç›´æŽ¥ä½¿ç”¨ extension ä¸­çš„èƒ½é‡ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å·²ç»æ”¾ç½®å¥½äº†å¯¹åº”çš„å»ºç­‘å·¥åœ°ï¼ˆconstruction siteï¼‰ã€‚










	è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç”¨äºŽå»ºé€ å»ºç­‘çš„æ–° creepã€‚è¿™ä¸ªè¿‡ç¨‹å’Œä¹‹å‰çš„æ•™ç¨‹ç« èŠ‚ç±»ä¼¼ã€‚ä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬å°†ä½¿ç”¨ Spawn.spawnCreep æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ç›´æŽ¥ä¸ºæ–°çš„ creep è®¾ç½® memoryã€‚
å­µåŒ–ä¸€ä¸ªèº«ä½“éƒ¨ä»¶ä¸º [WORK,CARRY,MOVE]ï¼Œåå­—ä¸º Builder1ï¼Œå¹¶ä¸”å†…å­˜ä¸º {role:'builder'} çš„ creepã€‚


Game.spawns['Spawn1'].spawnCreep( [WORK, CARRY, MOVE], 'Builder1',
    { memory: { role: 'builder' } } );











	å’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªè§’è‰²æ”¾åˆ°å•ç‹¬çš„æ¨¡å— role.builder ä¸­ã€‚å»ºé€ æ˜¯é€šè¿‡å¯¹å»ºç­‘å·¥åœ°æ‰§è¡Œ Creep.build æ–¹æ³•è¿›è¡Œçš„ï¼Œè€Œå·¥åœ°åˆ™å¯ä»¥é€šè¿‡ Room.find(FIND_CONSTRUCTION_SITES) æœç´¢å¾—åˆ°ã€‚å»ºé€ å»ºç­‘éœ€è¦èƒ½é‡ï¼Œæ‚¨çš„ creep åº”è¯¥è‡ªå·±åŽ»é‡‡é›†å®ƒä»¬ã€‚
ä¸ºäº†é¿å…ç”±äºŽèº«ä¸Šèµ„æºè€—å°½è€Œé¢‘ç¹çš„æ¥å›žç§»åŠ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡æ·»åŠ ä¸€ä¸ªæ–°çš„å¸ƒå°”å˜é‡ creep.memory.building æ¥å¢žå¼ºä¸€ä¸‹ä»£ç ï¼Œè¿™ä¸ªå˜é‡å°†ä¼šå‘Šè¯‰ creep åº”è¯¥ä½•æ—¶åˆ‡æ¢ä»»åŠ¡ã€‚æˆ‘ä»¬è¿˜è°ƒç”¨äº† creep.say å¹¶ä¸”åœ¨ moveTo æ–¹æ³•ä¸­æ·»åŠ äº† visualizePathStyle é€‰é¡¹æ¥å¯è§†åŒ– creep çš„ç§»åŠ¨è·¯å¾„ã€‚
	åˆ›å»ºä¸€ä¸ªåä¸º role.builder çš„æ¨¡å—ï¼Œå¹¶å†™å…¥æ–° creep çš„è¡Œä¸ºé€»è¾‘ã€‚
æ–‡æ¡£ï¼š
RoomObject.room
Room.find
Creep.build
Creep.say


var roleBuilder = {

    /** @param {Creep} creep **/
    run: function(creep) {

	    if(creep.memory.building && creep.store[RESOURCE_ENERGY] == 0) {
            creep.memory.building = false;
            creep.say('ðŸ”„ harvest');
	    }
	    if(!creep.memory.building && creep.store.getFreeCapacity() == 0) {
	        creep.memory.building = true;
	        creep.say('ðŸš§ build');
	    }

	    if(creep.memory.building) {
	        var targets = creep.room.find(FIND_CONSTRUCTION_SITES);
            if(targets.length) {
                if(creep.build(targets[0]) == ERR_NOT_IN_RANGE) {
                //ç§»åŠ¨æ—¶ç”»çº¿
                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});
                }
            }
	    }
	    else {
	        var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});
            }
	    }
	}
};

module.exports = roleBuilder;








	è®©æˆ‘ä»¬åœ¨ main æ¨¡å—ä¸­å¼•ç”¨æ–°çš„è§’è‰²å¹¶çž§çž§ä¼šå‘ç”Ÿä»€ä¹ˆã€‚
	é€šè¿‡åœ¨æ–° creep ä¸Šåº”ç”¨ role.builder æ¨¡å—æ¥å»ºé€ å…¨éƒ¨ 5 ä¸ª extensionã€‚
	
	
	
var roleHarvester = require('role.harvester');
var roleBuilder = require('role.builder');

module.exports.loop = function () {

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'builder') {
            roleBuilder.run(creep);
        }
    }
}




æƒ³è¦ç»´æŠ¤ extensionï¼Œæ‚¨éœ€è¦æ•™ä¼šæ‚¨çš„é‡‡é›†å•ä½æŠŠèƒ½é‡è¿è¾“åˆ° extension è€Œä¸ä»…ä»…æ˜¯ spawnã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ Game.structures å¯¹è±¡æˆ–è€…åœ¨å¯¹åº”çš„æˆ¿é—´æ‰§è¡Œ Room.find(FIND_STRUCTURES) æ–¹æ³•è¿›è¡Œæœç´¢ã€‚æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼ï¼Œæ‚¨éƒ½éœ€è¦ç”¨åˆ¤æ–­æ¡ä»¶ structure.structureType == STRUCTURE_EXTENSIONï¼ˆæˆ–è€… structure instanceof StructureExtensionï¼‰å¯¹ç»“æžœåˆ—è¡¨è¿›è¡Œç­›é€‰ï¼Œè¿˜æœ‰åˆ«å¿˜äº†æ£€æŸ¥å®ƒä»¬å­˜æœ‰å¤šå°‘èƒ½é‡ï¼ˆå°±åƒä¹‹å‰æ£€æŸ¥ creep ä¸€æ ·ï¼‰ã€‚

ä¼˜åŒ– role.harvester æ¨¡å—ä¸­çš„é€»è¾‘ã€‚
æ–‡æ¡£ï¼š
Game.structures
Room.find
StructureExtension


var roleHarvester = {

    /** @param {Creep} creep **/
    run: function(creep) {
	    if(creep.store.getFreeCapacity() > 0) {
            var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});
            }
        }
        else {
            var targets = creep.room.find(FIND_STRUCTURES, {
                    filter: (structure) => {
                        return (structure.structureType == STRUCTURE_EXTENSION || structure.structureType == STRUCTURE_SPAWN) &&
                            structure.store.getFreeCapacity(RESOURCE_ENERGY) > 0;
                    }
            });
            if(targets.length > 0) {
                if(creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {
                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});
                }
            }
        }
	}
};

module.exports = roleHarvester;









æƒ³è¦äº†è§£æˆ¿é—´é‡Œæ€»å…±æœ‰å¤šå°‘èƒ½é‡å¯ä»¥ç”¨äºŽå­µåŒ–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Room.energyAvailable å±žæ€§ã€‚è®©æˆ‘ä»¬æŠŠè¿™ä¸ªå±žæ€§è¾“å‡ºåˆ°æŽ§åˆ¶å°ä¸­ä»¥ä¾¿åœ¨ extension å¡«å……æœŸé—´å¯¹å…¶è¿›è¡Œè¿½è¸ªã€‚

æ‰¾åˆ°å…¨éƒ¨çš„ 5 ä¸ª extension ä»¥åŠ spawn å¹¶å¡«å……èƒ½é‡ã€‚
æ–‡æ¡£ï¼š
Room.energyAvailable


var roleHarvester = require('role.harvester');
var roleBuilder = require('role.builder');

module.exports.loop = function () {

    for(var name in Game.rooms) {
        console.log('Room "'+name+'" has '+Game.rooms[name].energyAvailable+' energy');
    }

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'builder') {
            roleBuilder.run(creep);
        }
    }
}







	çŽ°åœ¨æˆ‘ä»¬çš„ spawn å’Œ extension ä¸­æ€»å…±æœ‰ 550 ç‚¹èƒ½é‡ã€‚è¿™å·²ç»è¶³å¤Ÿå»ºé€ ä¸€ä¸ªèº«ä½“éƒ¨ä»¶ä¸º [WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE] çš„ creep äº†ã€‚è¿™ä¸ª creep çš„æ•ˆçŽ‡æ˜¯æ™®é€šå·¥ä½œå•ä½çš„ 4 å€ã€‚ä½†æ˜¯è¿™ä¹Ÿè®©å®ƒå˜å¾—æ›´é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™å®ƒæ·»åŠ äº†é¢å¤–çš„ MOVE éƒ¨ä»¶ã€‚ä½†æ˜¯ï¼Œä¸¤ä¸ª MOVE ä¹Ÿæ²¡åŠžæ³•è®©å®ƒè·‘å¾—åƒå° creep é‚£æ ·å¿«ï¼Œé™¤éžæˆ‘ä»¬ç»™ä»–æ·»åŠ  4 ä¸ª MOVE æˆ–è€…ä¿®ä¸€æ¡è·¯ã€‚
	å­µåŒ–ä¸€ä¸ªèº«ä½“éƒ¨ä»¶ä¸º [WORK,WORK,WORK,CARRY,MOVE,MOVE]ï¼Œåç§°ä¸º HarvesterBig çš„ creep å¹¶ä¸”è®¾ä¸º harvester è§’è‰²ã€‚
	
	
Game.spawns['Spawn1'].spawnCreep( [WORK,WORK,WORK,WORK,CARRY,MOVE,MOVE],
    'HarvesterBig',
    { memory: { role: 'harvester' } } );
    
    
    
    
    æ¯ç§’å¯ä»¥é‡‡é›†8ä¸ªTickè¿™æ ·å¯ä»¥ä¸ºä½ æ›´å¥½çš„æ‰©å±•ä½ çš„çŽ‹å›½
    å› æ­¤ï¼Œé€šè¿‡å‡çº§æ‚¨çš„ controllerï¼Œå»ºé€ æ–°çš„ extension å’Œæ›´å¼ºå¤§çš„ creepï¼Œæ‚¨æ®–æ°‘åœ°çš„æ•ˆçŽ‡å°†ä¼šè¢«æžå¤§çš„æå‡ã€‚å¹¶ä¸”ï¼Œæ‚¨å¯ä»¥ç”¨å¤§åž‹çš„ creep ä»£æ›¿ä¸€ç¾¤å°åž‹çš„ creep æ¥å‡å°‘ç”¨äºŽæ“æŽ§å®ƒä»¬çš„ CPUï¼Œè¯·è®°ä½å®ƒï¼Œè¿™åœ¨å¤šäººæ¸¸æˆé‡Œéžå¸¸é‡è¦ã€‚
åœ¨ä¸‹ä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•å»ºç«‹èµ·æ–° creep çš„è‡ªåŠ¨å­µåŒ–æœºåˆ¶ã€‚







###############################################ç¬¬å››å…³##################################################

###############################################ç¬¬å››å…³##################################################

###############################################ç¬¬å››å…³##################################################

*************************è‡ªåŠ¨å­µåŒ–creep*****************************






	åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡åœ¨æŽ§åˆ¶å°ä¸­è¾“å…¥å‘½ä»¤æ¥æ‰‹åŠ¨åˆ›å»ºæ–°çš„ creepã€‚æˆ‘ä»¬å¹¶ä¸æŽ¨èç»å¸¸è¿™ä¹ˆåšï¼Œå› ä¸º Screeps çš„ä¸»æ—¨å°±æ˜¯è®©æ‚¨çš„æ®–æ°‘åœ°å®žçŽ°è‡ªæˆ‘æŽ§åˆ¶ã€‚æ›´å¥½çš„åšæ³•æ˜¯æ•™ä¼šæ‚¨è¿™ä¸ªæˆ¿é—´ä¸­çš„ spawn è‡ªå·±ç”Ÿäº§ creepã€‚
è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„é—®é¢˜ï¼Œè®¸å¤šçŽ©å®¶ä¼šèŠ±è´¹å‡ ä¸ªæœˆçš„æ—¶é—´æ¥å®Œå–„å’Œå¢žå¼ºä»–ä»¬çš„è‡ªåŠ¨å­µåŒ–ä»£ç ã€‚ä½†æ˜¯å…ˆè®©æˆ‘ä»¬ä»Žç®€å•å¼€å§‹ï¼Œæ¥äº†è§£ä¸€äº›ç›¸å…³çš„åŸºæœ¬åŽŸåˆ™ã€‚



	æ‚¨éœ€è¦åœ¨è€çš„ creep å› ä¸ºå¯¿å‘½æˆ–å…¶ä»–åŽŸå› æ­»æŽ‰æ—¶å­µåŒ–æ–°çš„ creepã€‚ç”±äºŽæ¸¸æˆä¸­æ²¡æœ‰äº‹ä»¶æœºåˆ¶æ¥æŠ¥å‘Šç‰¹å®š creep çš„æ­»äº¡ã€‚æ‰€ä»¥æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯é€šè¿‡ç»Ÿè®¡æ¯ç§ creep çš„æ•°é‡ï¼Œä¸€æ—¦å…¶æ•°é‡ä½ŽäºŽç»™å®šå€¼ï¼Œå°±å¼€å§‹å­µåŒ–ã€‚
æœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥ç»Ÿè®¡æŒ‡å®šç±»åž‹çš„ creep æ•°é‡ã€‚å…¶ä¸­ä¸€ç§å°±æ˜¯é€šè¿‡ _.filter æ–¹æ³•ä»¥åŠ creep å†…å­˜ä¸­çš„ role å­—æ®µå¯¹ Game.creeps è¿›è¡Œç­›é€‰ã€‚è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼Œå¹¶æŠŠ creep çš„æ•°é‡æ˜¾ç¤ºåœ¨æŽ§åˆ¶å°ä¸­ã€‚
	æŠŠ harvester è§’è‰²çš„ creep æ•°é‡æ˜¾ç¤ºåœ¨æŽ§åˆ¶å°ä¸­ã€‚
	
	
var roleHarvester = require('role.harvester');
var roleUpgrader = require('role.upgrader');

module.exports.loop = function () {

    var harvesters = _.filter(Game.creeps, (creep) => creep.memory.role == 'harvester');
    console.log('Harvesters: ' + harvesters.length);

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'upgrader') {
            roleUpgrader.run(creep);
        }
    }
}











	å‡è®¾æˆ‘ä»¬æœ€å°‘éœ€è¦ç»´æŒä¸¤ä¸ªé‡‡é›†å•ä½ï¼ˆharvesterï¼‰ï¼Œæœ€ç®€å•çš„åŠžæ³•å°±æ˜¯ï¼šæ¯å½“æˆ‘ä»¬å‘çŽ°å®ƒä»¬çš„æ•°é‡å°äºŽè¿™ä¸ªå€¼æ—¶ï¼Œå°±æ‰§è¡Œ StructureSpawn.spawnCreep æ–¹æ³•ã€‚æ‚¨å¯èƒ½è¿˜æ²¡æƒ³å¥½å®ƒä»¬åº”è¯¥å«ä»€ä¹ˆï¼ˆè¿™ä¸€æ­¥æˆ‘ä»¬ä¼šè‡ªåŠ¨ç»™å®ƒä»¬èµ·åå­—ï¼‰ï¼Œä½†æ˜¯ä¸è¦å¿˜äº†ç»™ä»–ä»¬è®¾ç½®éœ€è¦çš„è§’è‰²ï¼ˆroleï¼‰ã€‚
	æˆ‘ä»¬è¿˜ä¼šæ·»åŠ ä¸€äº›æ–°çš„ RoomVisual æ¥æ˜¾ç¤ºå½“å‰æ­£åœ¨å­µåŒ–çš„ creepã€‚
	åœ¨æ‚¨çš„ main æ¨¡å—ä¸­æ·»åŠ  StructureSpawn.spawnCreep ç›¸å…³é€»è¾‘ã€‚
æ–‡æ¡£ï¼š
StructureSpawn.spawnCreep
RoomVisual


var roleHarvester = require('role.harvester');
var roleUpgrader = require('role.upgrader');

module.exports.loop = function () {

    var harvesters = _.filter(Game.creeps, (creep) => creep.memory.role == 'harvester');
    console.log('Harvesters: ' + harvesters.length);

    if(harvesters.length < 2) {
        var newName = 'Harvester' + Game.time;
        console.log('Spawning new harvester: ' + newName);
        Game.spawns['Spawn1'].spawnCreep([WORK,CARRY,MOVE], newName, 
            {memory: {role: 'harvester'}});        
    }
    
    if(Game.spawns['Spawn1'].spawning) { 
        var spawningCreep = Game.creeps[Game.spawns['Spawn1'].spawning.name];
        Game.spawns['Spawn1'].room.visual.text(
            'ðŸ› ï¸' + spawningCreep.memory.role,
            Game.spawns['Spawn1'].pos.x + 1, 
            Game.spawns['Spawn1'].pos.y, 
            {align: 'left', opacity: 0.8});
    }

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'upgrader') {
            roleUpgrader.run(creep);
        }
    }
}






	çŽ°åœ¨è®©æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹ï¼Œå½“ä¸€ä¸ªé‡‡é›†å•ä½æ­»æŽ‰äº†çš„æƒ…å†µã€‚æ‚¨å¯ä»¥åœ¨æŽ§åˆ¶å°ä¸­å¯¹æŒ‡å®š creep æ‰§è¡Œ suicide å‘½ä»¤ï¼Œæˆ–è€…ç›´æŽ¥åœ¨å³ä¾§çš„å±žæ€§é¢æ¿ä¸­ç‚¹å‡» â€œè‡ªæ€â€ æŒ‰é’®ã€‚
	è®©æŸä¸ªé‡‡é›†å•ä½è‡ªæ€ã€‚
æ–‡æ¡£ï¼š
Creep.suicide


Game.creeps['Harvester1'].suicide()







	è¿˜æœ‰ä¸€ä»¶äº‹ï¼Œç”±äºŽæ­»äº¡ creep çš„å†…å­˜æˆ‘ä»¬ä¹‹åŽå¯èƒ½ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥å®ƒä»¬å¹¶ä¸ä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚å¦‚æžœæ‚¨æ¯æ¬¡éƒ½ç”¨éšæœºåç§°åŽ»å­µåŒ–æ–° creep çš„è¯ï¼Œå†…å­˜å¯èƒ½ä¼šå› æ­¤æº¢å‡ºï¼Œæ‰€ä»¥æ‚¨éœ€è¦åœ¨æ¯ä¸ª tick å¼€å§‹çš„æ—¶å€™å°†å®ƒä»¬æ¸…é™¤æŽ‰ï¼ˆcreep åˆ›å»ºä»£ç ä¹‹å‰ï¼‰ã€‚
	æ·»åŠ æ¸…ç†å†…å­˜çš„ä»£ç ã€‚
	

var roleHarvester = require('role.harvester');
var roleUpgrader = require('role.upgrader');

module.exports.loop = function () {

    for(var name in Memory.creeps) {
        if(!Game.creeps[name]) {
            delete Memory.creeps[name];
            console.log('Clearing non-existing creep memory:', name);
        }
    }

    var harvesters = _.filter(Game.creeps, (creep) => creep.memory.role == 'harvester');
    console.log('Harvesters: ' + harvesters.length);

    if(harvesters.length < 2) {
        var newName = 'Harvester' + Game.time;
        console.log('Spawning new harvester: ' + newName);
        Game.spawns['Spawn1'].spawnCreep([WORK,CARRY,MOVE], newName, 
            {memory: {role: 'harvester'}});
    }
    
    if(Game.spawns['Spawn1'].spawning) { 
        var spawningCreep = Game.creeps[Game.spawns['Spawn1'].spawning.name];
        Game.spawns['Spawn1'].room.visual.text(
            'ðŸ› ï¸' + spawningCreep.memory.role,
            Game.spawns['Spawn1'].pos.x + 1, 
            Game.spawns['Spawn1'].pos.y, 
            {align: 'left', opacity: 0.8});
    }

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'upgrader') {
            roleUpgrader.run(creep);
        }
    }
}








	çŽ°åœ¨ï¼Œæ­»è€…çš„å†…å­˜è¢«å›žæ”¶æŽ‰äº†ï¼Œè¿™æœ‰åŠ©äºŽå¸®åŠ©æˆ‘ä»¬èŠ‚çœèµ„æºã€‚
	é™¤äº†åœ¨è€ creep æ­»æŽ‰ä¹‹åŽå†åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•å¯ä»¥æŠŠ creep çš„æ•°é‡ç»´æŒåœ¨æœŸæœ›å€¼ï¼šStructureSpawn.renewCreep æ–¹æ³•ã€‚ä¸è¿‡åœ¨æœ¬æ•™ç¨‹ä¸­ creep çš„è€åŒ–å·²ç»è¢«ç¦ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å»ºè®®æ‚¨è‡ªå·±å°è¯•äº†è§£ä¸€ä¸‹ã€‚
æ–‡æ¡£ï¼š
StructureSpawn.renewCreep









###############################################ç¬¬äº”å…³##################################################

###############################################ç¬¬äº”å…³##################################################

###############################################ç¬¬äº”å…³##################################################

*************************é˜²å®ˆæ‚¨çš„æˆ¿é—´*****************************






Screeps çš„ä¸–ç•Œå¹¶ä¸å®‰å…¨ã€‚å…¶ä»–çŽ©å®¶å¯èƒ½æƒ³è¦å é¢†æ‚¨çš„é¢†åœŸã€‚æ­¤å¤–ï¼Œæ‚¨çš„æˆ¿é—´ä¹Ÿä¼šå¶å°”é­åˆ°ä¸­ç«‹ NPC creep çš„è¢­å‡»ã€‚æ‰€ä»¥ï¼Œæ‚¨éœ€è¦å¥½å¥½è€ƒè™‘ä¸‹æ®–æ°‘åœ°çš„é˜²å¾¡ï¼Œè¿™æ ·æ‚¨æ‰èƒ½æ›´åŠ å®‰å…¨çš„å‘å±•è‡ªå·±ã€‚

æ–‡æ¡£ï¼š
é˜²å¾¡æ‚¨çš„æˆ¿é—´(https://screeps-cn.gitee.io/defense.html)




	æ•Œæ–¹ creep ä»Žæˆ¿é—´å·¦è¾¹çš„å…¥å£å…¥ä¾µå¹¶è¢­å‡»äº†æ‚¨çš„æ®–æ°‘åœ°ã€‚ç”±äºŽæˆ‘ä»¬æœ‰å¢™å£å¯ä»¥æš‚æ—¶æŠµæŒ¡å®ƒçš„è¿›æ”»ï¼Œæ‰€ä»¥ç›®å‰é—®é¢˜ä¸å¤§ã€‚ä½†æ˜¯å¢™å£è¿Ÿæ—©ä¼šè¢«æ‰“ç©¿ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°½å¿«è§£å†³è¿™ä¸ªé—®é¢˜ã€‚




	æŠµå¾¡è¿›æ”»æœ€å¯é çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨æˆ¿é—´çš„ å®‰å…¨æ¨¡å¼ï¼ˆSafe Modeï¼‰ã€‚åœ¨å®‰å…¨æ¨¡å¼ä¸­ï¼Œæˆ¿é—´ä¸­ä»»ä½•éžå·±æ–¹ creep éƒ½æ— æ³•æ‰§è¡Œä»»ä½•æœ‰å®³çš„æ“ä½œï¼ˆä½†æ˜¯æ‚¨ä¾æ—§å¯ä»¥è¿›è¡ŒåæŠ—ã€‚ï¼‰
	å®‰å…¨æ¨¡å¼æ˜¯é€šè¿‡æˆ¿é—´æŽ§åˆ¶å™¨ï¼ˆcontrollerï¼‰æ¿€æ´»çš„ï¼Œä¸è¿‡é¦–å…ˆæˆ‘ä»¬è¦æœ‰å¯ç”¨çš„æ¿€æ´»æ¬¡æ•°ã€‚çŽ°åœ¨è®©æˆ‘ä»¬åœ¨æˆ¿é—´ä¸­å¯åŠ¨å®‰å…¨æ¨¡å¼ã€‚
	æ¿€æ´»å®‰å…¨æ¨¡å¼ã€‚
æ–‡æ¡£ï¼š
StructureController.activateSafeMode


Game.spawns['Spawn1'].room.controller.activateSafeMode();








	å¦‚æ‚¨æ‰€è§ï¼Œæ•Œæ–¹ creep å·²ç»ä¸å†è¿›æ”»å¢™å£äº† - å®ƒçš„æœ‰å®³æ“ä½œè¢«é˜»æ­¢äº†ã€‚æˆ‘ä»¬å»ºè®®æ‚¨åœ¨æˆ¿é—´çš„é˜²å¾¡å¤±æ•ˆæ—¶å†æ¿€æ´»å®‰å…¨æ¨¡å¼ã€‚
	çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬æŠŠè¿™äº›ä¸é€Ÿä¹‹å®¢æ¸…ç†æŽ‰ã€‚



	é˜²å¾¡å¡”ï¼ˆtowerï¼‰æ˜¯é˜²å¾¡æˆ¿é—´æœ€ç®€å•ç›´æŽ¥çš„æ‰‹æ®µã€‚å®ƒä»¬å¯ä»¥æ¶ˆè€—èƒ½é‡æ¥æ²»ç–—æˆ–æ”»å‡»æˆ¿é—´ä¸­çš„ä»»ä½• creepã€‚æ²»ç–—/æ”»å‡»æ•ˆæžœå–å†³äºŽ tower å’Œç›®æ ‡ä¹‹é—´çš„ç›´çº¿è·ç¦»ã€‚
	é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç»™æ–° tower æ‰“å¥½åœ°åŸºã€‚æ‚¨å¯ä»¥åœ¨å¢™å£ä¹‹å†…çš„ä»»ä½•ä½ç½®æ”¾ç½® tower çš„å·¥åœ°ï¼Œé€šè¿‡é¡¶éƒ¨é¢æ¿ä¸­çš„ â€œå»ºé€ â€ æŒ‰é’®æ‰¾åˆ°å®ƒã€‚
	æ”¾ç½® Tower çš„å·¥åœ°ï¼ˆæ‰‹åŠ¨æˆ–ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼‰ã€‚
æ–‡æ¡£ï¼š
StructureTower
Room.createConstructionSite


Game.spawns['Spawn1'].room.createConstructionSite( 23, 22, STRUCTURE_TOWER );


	creep Builder1 ç«‹åˆ»ååº”è¿‡æ¥å¹¶å¼€å§‹äº†å»ºé€ ã€‚çŽ°åœ¨è®©æˆ‘ä»¬ç­‰å®ƒé€ å¥½ã€‚
	
	
	
	tower éœ€è¦èƒ½é‡ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ”¹é€ ä¸€ä¸‹ harvester è§’è‰²ï¼Œè®©å…¶å¯ä»¥æŠŠèƒ½é‡å¸¦åˆ° tower å’Œå…¶ä»–å»ºç­‘ä¸­ã€‚æƒ³è¦å®žçŽ°è¿™ä¸ªåŠŸèƒ½ï¼Œæ‚¨éœ€è¦å°† STRUCTURE_TOWER å¸¸é‡æ·»åŠ åˆ°ç”¨äºŽç­›é€‰æ‚¨é‡‡é›†å•ä½ç›®æ ‡çš„ filter ä¸­ã€‚
	åœ¨ role.harvester æ¨¡å—ä¸­æ·»åŠ  STRUCTURE_TOWERï¼Œç„¶åŽç­‰å¾…èƒ½é‡è¿é€åˆ° tower ä¸­ã€‚
	
	
var roleHarvester = {

    /** @param {Creep} creep **/
    run: function(creep) {
	    if(creep.store.getFreeCapacity() > 0) {
            var sources = creep.room.find(FIND_SOURCES);
            if(creep.harvest(sources[0]) == ERR_NOT_IN_RANGE) {
                creep.moveTo(sources[0], {visualizePathStyle: {stroke: '#ffaa00'}});
            }
        }
        else {
            var targets = creep.room.find(FIND_STRUCTURES, {
                    filter: (structure) => {
                        return (structure.structureType == STRUCTURE_EXTENSION ||
                                structure.structureType == STRUCTURE_SPAWN ||
                                structure.structureType == STRUCTURE_TOWER) && 
                                structure.store.getFreeCapacity(RESOURCE_ENERGY) > 0;
                    }
            });
            if(targets.length > 0) {
                if(creep.transfer(targets[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {
                    creep.moveTo(targets[0], {visualizePathStyle: {stroke: '#ffffff'}});
                }
            }
        }
	}
};

module.exports = roleHarvester;








	æ£’æžäº†ï¼Œæ‚¨çš„ tower å·²ç»å‡†å¤‡å°±ç»ªäº†ï¼
	å°±åƒ creep ä¸€æ ·ï¼Œtower ä¹Ÿæœ‰å‡ ä¸ªç±»ä¼¼çš„æ–¹æ³•ï¼šattack - æ”»å‡»ï¼Œheal - æ²»ç–—ï¼Œä»¥åŠ repair - ç»´ä¿®ã€‚æ¯ä¸ªæ“ä½œéƒ½ä¼šæ¶ˆè€— 10 ç‚¹èƒ½é‡ã€‚ä¸€æ—¦å‘çŽ°äº†æ•Œäººï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ attack æ–¹æ³•æ”»å‡»è·ç¦»æœ€è¿‘çš„æ•Œæ–¹ creepã€‚è¯·è®°ä½ï¼Œè·ç¦»éžå¸¸é‡è¦ï¼šåœ¨ç›¸åŒçš„èƒ½é‡æ¶ˆè€—ä¸‹ï¼Œæ“ä½œå¸¦æ¥çš„æ•ˆæžœå¯èƒ½ä¼šæœ‰å¥½å‡ å€çš„å·®è·ã€‚
	æƒ³è¦èŽ·å– tower çš„å¯¹è±¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒçš„ IDï¼ˆå³ä¾§é¢æ¿ä¸­ï¼‰ä»¥åŠ Game.getObjectById æ–¹æ³•ã€‚
	ä½¿ç”¨ tower æ¶ˆç­æ•Œæ–¹ creepã€‚
æ–‡æ¡£ï¼š
Game.getObjectById
RoomObject.pos
RoomPosition.findClosestByRange
StructureTower.attack


var roleHarvester = require('role.harvester');
var roleUpgrader = require('role.upgrader');
var roleBuilder = require('role.builder');

module.exports.loop = function () {

    var tower = Game.getObjectById('39ddca24979bed2599f6f782');
    if(tower) {
        var closestHostile = tower.pos.findClosestByRange(FIND_HOSTILE_CREEPS);
        if(closestHostile) {
            tower.attack(closestHostile);
        }
    }

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'upgrader') {
            roleUpgrader.run(creep);
        }
        if(creep.memory.role == 'builder') {
            roleBuilder.run(creep);
        }
    }
}





	æ•Œæ–¹è •è™«ç»ˆäºŽæ­»äº†ï¼Œæˆ‘ä»¬æ¾äº†ä¸€å£æ°”ï¼Œä½†æ˜¯è¿˜æ˜¯å¯¹å¢™å£é€ æˆäº†ä¼¤å®³ã€‚
æˆ‘æŽ¨èå¢žåŠ è‡ªåŠ¨ç»´ä¿®ç³»ç»Ÿã€‚







	creep å’Œ tower éƒ½å¯ä»¥ä¿®å¤å—æŸçš„å»ºç­‘ï¼Œè¿™æ¬¡è®©æˆ‘ä»¬ç”¨ tower æ¥è¯•ä¸€ä¸‹ã€‚ä½¿ç”¨ repair æ–¹æ³•å¯ä»¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ‚¨è¿˜éœ€è¦ä½¿ç”¨ Room.find æ–¹æ³•å’Œä¸€ä¸ª filter åŽ»ç­›é€‰é™¤é‚£äº›å—æŸçš„å¢™å£ï¼ˆwallï¼‰ã€‚
	è¯·æ³¨æ„ï¼Œç”±äºŽå¢™å£ä¸å±žäºŽä»»ä½•çŽ©å®¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ FIND_STRUCTURES å¸¸é‡è¿›è¡Œæœç´¢è€Œä¸æ˜¯ FIND_MY_STRUCTURESã€‚
	ä¿®å¤æ‰€æœ‰å—æŸçš„å¢™å£ï¼ˆwallï¼‰ã€‚
æ–‡æ¡£ï¼š
Room.find
StructureTower.repair


var roleHarvester = require('role.harvester');
var roleUpgrader = require('role.upgrader');
var roleBuilder = require('role.builder');

module.exports.loop = function () {

    var tower = Game.getObjectById('39ddca24979bed2599f6f782');
    if(tower) {
        var closestDamagedStructure = tower.pos.findClosestByRange(FIND_STRUCTURES, {
            filter: (structure) => structure.hits < structure.hitsMax
        });
        if(closestDamagedStructure) {
            tower.repair(closestDamagedStructure);
        }

        var closestHostile = tower.pos.findClosestByRange(FIND_HOSTILE_CREEPS);
        if(closestHostile) {
            tower.attack(closestHostile);
        }
    }

    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
        }
        if(creep.memory.role == 'upgrader') {
            roleUpgrader.run(creep);
        }
        if(creep.memory.role == 'builder') {
            roleBuilder.run(creep);
        }
    }
}








	æ‰€æœ‰åœ¨è¢­å‡»ä¸­å—æŸçš„å»ºç­‘éƒ½è¢«ä¿®å¥½äº†ï¼
	æ­å–œï¼Œæ‚¨å·²ç»å®Œæˆäº†å…¨éƒ¨çš„æ•™ç¨‹ï¼çŽ°åœ¨æ‚¨å·²ç»æœ‰è¶³å¤Ÿçš„çŸ¥è¯†å’Œä»£ç å¯ä»¥åœ¨çº¿ä¸Šæ¨¡å¼ä¸­æ¸¸çŽ©äº†ã€‚æŒ‘é€‰æ‚¨çš„æˆ¿é—´ï¼Œå»ºç«‹æ®–æ°‘åœ°ï¼Œç„¶åŽæŒ‰ç…§æ‚¨çš„æ„æ„¿åœ¨ Screeps çš„ä¸–ç•Œä¸­å»ºç«‹ç»Ÿæ²»ï¼
	
å¦‚æžœæ‚¨æƒ³æ›´æ·±å…¥çš„äº†è§£æ¸¸æˆæˆ–è€…æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶å‚è€ƒï¼š
æ–‡æ¡£(http://docs.screeps.com/)
è®ºå›(https://screeps.com/forum/)
Discord server(http://chat.screeps.com/)
Have fun scripting!